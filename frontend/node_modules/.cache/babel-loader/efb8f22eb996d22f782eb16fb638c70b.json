{"ast":null,"code":"import _asyncToGenerator from\"/Users/fkhw/CourseWorks/Cloud Computing & Big Data/homework2/photo-search/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/fkhw/CourseWorks/Cloud Computing & Big Data/homework2/photo-search/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/fkhw/CourseWorks/Cloud Computing & Big Data/homework2/photo-search/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export function SearchPhotos(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),query=_useState2[0],setQuery=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),labels=_useState4[0],setlabels=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),imageSelected=_useState6[0],setImage=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),pics=_useState8[0],setPics=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),listening=_useState10[0],setListening=_useState10[1];var SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;var recognition=new SpeechRecognition();recognition.continuous=true;recognition.lang='en-US';recognition.onstart=function(){console.log(\"Listening...\");};recognition.onend=function(){console.log(\"Stop Listening!\");};recognition.onresult=function(event){var current=event.resultIndex;var transcript=event.results[current][0].transcript.toLowerCase().trim();if(transcript===\"stop\"){recognition.stop();}else{console.log('else:',query);setQuery(transcript);};console.log(transcript);};function vioceInput(e){e.preventDefault();if(!listening){recognition.start();setListening(true);}else{recognition.stop();setListening(false);}};var searchPhotos=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(e){e.preventDefault();};console.log(\"search for \".concat(query));_context.next=5;return fetch(\"https://ri9wp1d2z2.execute-api.us-east-1.amazonaws.com/a2/search?q=\".concat(query),{headers:{\"x-api-key\":'jiVJQZYBAQa7DAi0PNYHj8lDrVHG5ADn1tYgS3Xu'}}).then(function(response){return response.json();}).then(function(data){return setPics(data);});case 5:console.log(pics);case 6:case\"end\":return _context.stop();}}},_callee);}));return function searchPhotos(_x){return _ref.apply(this,arguments);};}();var fileSelectHandeler=function fileSelectHandeler(event){setImage(event.target.files[0]);};function uuidv4(){// ref:https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\nreturn([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(c){return(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16);});}var uploadPhotos=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();if(!imageSelected){_context2.next=5;break;}console.log(\"upload\");_context2.next=5;return fetch(\"https://ri9wp1d2z2.execute-api.us-east-1.amazonaws.com/a2/b2a26998008/\".concat(uuidv4(),\".\").concat(imageSelected.name.split('.').slice(-1)[0]),{method:\"put\",headers:{\"Content-Type\":\"image/png\",\"x-amz-meta-customLabels\":labels,\"x-api-key\":'jiVJQZYBAQa7DAi0PNYHj8lDrVHG5ADn1tYgS3Xu'},body:imageSelected});case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function uploadPhotos(_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"form\",{className:\"form\",onSubmit:searchPhotos,children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",htmlFor:\"query\",children:\" \"}),/*#__PURE__*/_jsx(\"input\",{required:true,type:\"text\",name:\"query\",className:\"input\",placeholder:\"Try \\\"dog\\\" or \\\"apple\\\"\",value:query,onChange:function onChange(e){return setQuery(e.target.value);}}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"button\",children:\"Search\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"voice-button\",onClick:vioceInput,children:\"\\uD83C\\uDFA4\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"form\",{className:\"form\",onSubmit:uploadPhotos,children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"img\",name:\"img\",accept:\"image/png, image/jpg\",onChange:fileSelectHandeler}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"labels\",className:\"input\",placeholder:\"Labels\",value:labels,onChange:function onChange(e){return setlabels(e.target.value);}}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"button\",children:\"Upload\"})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-list\",children:[pics.map(function(pic){return/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"img\",{className:\"card--image\",src:pic,width:\"50%\",height:\"50%\"})},pic);}),\";\"]})]});}","map":{"version":3,"sources":["/Users/fkhw/CourseWorks/Cloud Computing & Big Data/homework2/photo-search/src/searchPhotos.js"],"names":["React","useState","SearchPhotos","query","setQuery","labels","setlabels","imageSelected","setImage","pics","setPics","listening","setListening","SpeechRecognition","window","webkitSpeechRecognition","recognition","continuous","lang","onstart","console","log","onend","onresult","event","current","resultIndex","transcript","results","toLowerCase","trim","stop","vioceInput","e","preventDefault","start","searchPhotos","fetch","headers","then","response","json","data","fileSelectHandeler","target","files","uuidv4","replace","c","crypto","getRandomValues","Uint8Array","toString","uploadPhotos","name","split","slice","method","body","value","map","pic"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\n\n\n\nexport function SearchPhotos() {\n\n    const [query, setQuery] = useState(\"\");\n    const [labels, setlabels] = useState(\"\");\n    const [imageSelected, setImage] = useState(null);\n    const [pics, setPics] = useState([]);\n    const [listening, setListening] = useState(false);\n\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    const recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.lang = 'en-US';\n\n    recognition.onstart = function() {\n        console.log(\"Listening...\");\n    };\n\n    recognition.onend= function() {\n        console.log(\"Stop Listening!\");\n    };\n\n    recognition.onresult= function(event) {\n        const current = event.resultIndex;\n        const transcript = event.results[current][0].transcript.toLowerCase().trim();\n        if(transcript===\"stop\") {\n            recognition.stop();\n        }\n        else {\n            console.log('else:',query)\n            setQuery(transcript);\n        };\n        console.log(transcript)\n    };\n\n    function vioceInput(e){\n        e.preventDefault()\n        if (!listening){\n            recognition.start();\n            setListening(true);\n        } else {\n            recognition.stop();\n            setListening(false);\n        }\n        \n    };\n\n\n    const searchPhotos = async (e) => {\n        if (e){\n            e.preventDefault()\n        };\n        console.log(`search for ${query}`);\n        await fetch(`https://ri9wp1d2z2.execute-api.us-east-1.amazonaws.com/a2/search?q=${query}`,\n                {headers:{\n                    \"x-api-key\": 'jiVJQZYBAQa7DAi0PNYHj8lDrVHG5ADn1tYgS3Xu',\n                }\n                }\n            )\n            .then(response => response.json())\n            .then(data => setPics(data));\n        console.log(pics)\n    };\n\n    const fileSelectHandeler = event => {\n        setImage(event.target.files[0])\n    }\n\n    function uuidv4() {\n        // ref:https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\n        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\n          (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n        );\n    }\n\n    const uploadPhotos = async (e) => {\n        e.preventDefault()\n        if (imageSelected) {\n            console.log(`upload`);\n            await fetch(`https://ri9wp1d2z2.execute-api.us-east-1.amazonaws.com/a2/b2a26998008/${uuidv4()}.${imageSelected.name.split('.').slice(-1)[0]}`,\n                    {\n                        method: \"put\",\n                        headers:{\n                        \"Content-Type\": `image/png`,\n                        \"x-amz-meta-customLabels\": labels,\n                        \"x-api-key\": 'jiVJQZYBAQa7DAi0PNYHj8lDrVHG5ADn1tYgS3Xu',\n                        },\n                        body: imageSelected\n                    }\n                )\n        }\n    };\n\n\n    return (\n        <>\n        <form className=\"form\" onSubmit={searchPhotos}> \n            <label className=\"label\" htmlFor=\"query\"> </label>\n            <input\n                required\n                type=\"text\"\n                name=\"query\"\n                className=\"input\"\n                placeholder={`Try \"dog\" or \"apple\"`}\n                value={query}\n                onChange={(e) => setQuery(e.target.value)}\n            />\n            <button type=\"submit\" className=\"button\">Search</button>\n        </form>\n        <button className=\"voice-button\" onClick={vioceInput}>ðŸŽ¤</button>\n        <br></br>\n        \n        <form className=\"form\" onSubmit={uploadPhotos}>\n            <input type=\"file\" id=\"img\" name=\"img\" accept=\"image/png, image/jpg\" onChange={fileSelectHandeler}/>\n            <input\n                type=\"text\"\n                name=\"labels\"\n                className=\"input\"\n                placeholder={`Labels`}\n                value={labels}\n                onChange={(e) => setlabels(e.target.value)}\n            />\n            <button type=\"submit\" className=\"button\">Upload</button>\n        </form>\n\n        <br></br>\n        <br></br>\n        <div className=\"card-list\">\n            {\n                pics.map((pic) => \n                <div className=\"card\" key={pic} >\n                <img\n                    className=\"card--image\"\n                    src={pic}\n                    width=\"50%\"\n                    height=\"50%\"\n                ></img>\n                </div>)};\n        </div>\n    </>\n    );\n}"]},"metadata":{},"sourceType":"module"}